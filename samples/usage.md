# Usage examples

**_This document is a work in progress and not all features are documented yet_**.

This document focuses on usage overview and using the cli executable tool. The functionality is all also useable via library functions. Please see [foo.py](./foo.py) for library function examples.

To install the cli tool

```bash
pip install modelator-py;
```

To call the cli program

```bash
modelator <args>
```

## Extract traces from TLC output in [Informal Trace Format](https://apalache.informal.systems/docs/adr/015adr-trace.html?highlight=trace%20format#the-itf-format) format

The TLC model checker will generate counterexamples written in TLA+ and embed them in stdout, interleaved with ASCII text. This output can contain 0, 1 or more traces, and will extract traces generated by TLCs model checking or simulator modes. Run the `modelator util tlc itf` tool to extract a list of traces in the Informal Trace Format.

There is more than one way to run the tool. The tool always writes output as Json to `stdout`.

### Option 1: provide TLC's stdout data on stdin and flags as cli args

```bash
modelator util tlc itf --help
modelator util tlc itf < <TLC_STDOUT_STRING> # Run without flags
modelator util tlc itf --lists=<bool> --records=<bool> < <TLC_STDOUT_STRING> # Run with flags
```

### Option 2: provide TLC's stdout data and flags inside a json object

```bash
modelator util tlc itf --json < <JSON_OBJECT>
```

### Flag explanation

```bash
# In TLA+ there is no distinction between some functions and sequences. This means
# that a sequence may be represented by function with domain 1..n for some n,
# and vice versa. It is likely convenient to handle such functions as lists.
# Default: True
--lists
# In TLA+ there is no distinction between some functions and records. This means
# that a record may be represented by functions with domain all strings, and vice
# versa. It is likely convenient to handle such functions as records.
# Default: True
--records
```

### Examples

```bash
# Provide TLC's stdout data on stdin and flags as cli args
modelator util tlc itf --lists=False < TlcTraceParse.out > traces.json
# Provide TLC's stdout data and flags inside a json object
modelator util tlc itf --json < tests/resource/HelloWorld_util_tlc_itf.json > traces.json
```

### Nuance

The tool should be able to handle partial TLC outputs (if you hit `ctrl+c` while it was running, for example). The tool cannot handle lasso shaped traces yet (for temporal property violations). The tool _can_ handle multiple traces (generated when using TLC's `continue` feature, for example).

### FAQ

1. You can dump various formats using TLC's `-dumpTrace` flag. Why does this exist?\
This was written before that flag existed. This tool also supports multiple traces
2. Is this fast?\
Not really: it will take a while to extract traces with hundreds of thousands of states. If you're doing that you're likely doing model-based testing. For regular users, the speed is fine.
3. Why don't you parse the `TTrace` files that TLC outputs instead of parsing stdout?\
It probably should be done that way!
